<!DOCTYPE html>
<html lang="en">
  <head>
    <title>猜数字</title>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <style>
    .word-wrap {
      color: #7e7e7e;
      font-size: 20px;
    }
    .page {
       margin: 20px 0 0 0;
    }
    #number_input, #history {
      margin: 10px 0 0 0;
    }
    #number_submit {
      width: 100%;
      margin: 10px 0 20px 0;
    }
    table th {
      font-size: 18px;
      text-align: center;
    }
    table td {
      font-size: 14px;
      text-align: center;
    }
    </style>
  </head>
  <body>
    <div class="page">
      <div class="container">
        <div class="word-wrap">我这有个数，从 <font color="#EE7600">0000</font> 到 <font color="#EE7600">9999</font> 。</div>
        <div class="word-wrap">看看你几次能 <font color="#FF0000" style="font-size: 24px"><b>猜</b></font> 到！</div>
        <img src="images/law.png" width="100%"/>
        <table id="history" class="table table-hover table-bordered table-striped hidden">
          <tr><th>数字</th><th>结果</th></tr>
        </table>
				<input type="text" id="number_input" class="form-control" placeholder="请输入4个不同的0-9的数字" />
				<input type="submit" id="number_submit" class="btn btn-warning" value="先猜一次" data-first="0" />
      </div>
    </div>

    <!-- jQuery first, then Bootstrap JS. -->
    <script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script>
      var n = (function(){
        var f = function(){return parseInt(Math.random() * 10)};
        var ns = [f()];
        while (ns.length < 4) {
          var t = f();
          if (ns.indexOf(t) == -1) {
            ns.push(t);
          }
        }
        return ns;
      })();

      function is_good_number(s) {
        if(!/^[0-9]{4}$/.test(s)) {
          return false;
        }
        var a = parseInt(s[0]);
        var b = parseInt(s[1]);
        var c = parseInt(s[2]);
        var d = parseInt(s[3]);
        return a != b && a != c && a != d && b != c && b != d && c != d;
      }

      function to_numbers(s) {
        var a = parseInt(s[0]);
        var b = parseInt(s[1]);
        var c = parseInt(s[2]);
        var d = parseInt(s[3]);
        return [a, b, c, d];
      }

      function AandB(s) {
        var ns = to_numbers(s);
        var A = 0, B = 0;
        ns.map(function(e, i){
          if (n[i] == e) {
            A += 1;
          } else if (n.indexOf(e) != -1) {
            B += 1;
          }
        })
        return [A, B];
      }

      $("#number_submit").on("click", function(){
        var v = $("#number_input").val();
        if(!is_good_number(v)) {
          alert("请输入 4 个不同的 0-9 的数字，如 0352");
          return false;
        }
        var r = AandB(v);
        if(r[0] == 4 && r[1] == 4){
          alert("恭喜你，答对了！");
          return true;
        }
        if($("#number_submit").attr("data-first") == 0){
          $("#history").toggleClass("hidden");
          $("#number_submit").val("再猜一次");
          $("#number_submit").attr("data-first", 1);
        }
        $("#history").append("<tr><td>" + v + "</td><td>" + r[0] + "A" + r[1] + "B</td></tr>");
        return true;
      });
    </script>
  </body>
</html>
